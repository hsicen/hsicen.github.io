<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://localhost:4000</id>
    <title>hsicen</title>
    <updated>2021-07-22T13:42:51.249Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="http://localhost:4000"/>
    <link rel="self" href="http://localhost:4000/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>http://localhost:4000/images/avatar.png</logo>
    <icon>http://localhost:4000/favicon.ico</icon>
    <rights>All rights reserved 2021, hsicen</rights>
    <entry>
        <title type="html"><![CDATA[Retrofit]]></title>
        <id>http://localhost:4000/post/retrofit/</id>
        <link href="http://localhost:4000/post/retrofit/">
        </link>
        <updated>2021-07-22T13:37:03.000Z</updated>
        <content type="html"><![CDATA[<h5 id="retrofitçš„ç®€å•ä½¿ç”¨">Retrofitçš„ç®€å•ä½¿ç”¨</h5>
<h6 id="1-æ·»åŠ ä¾èµ–">1. æ·»åŠ ä¾èµ–</h6>
<pre><code class="language-groovy">implementation 'com.squareup.retrofit2:retrofit:2.6.0'
implementation 'com.squareup.retrofit2:adapter-rxjava2:2.6.0'
implementation 'com.squareup.retrofit2:converter-gson:2.6.0'
</code></pre>
<h6 id="2-åˆ›å»ºä¸€ä¸ªinterfaceä½œä¸ºweb-serviceçš„è¯·æ±‚é›†åˆåœ¨ä¸Šé¢ç”¨æ³¨è§£å†™å…¥éœ€è¦é…ç½®çš„è¯·æ±‚æ–¹æ³•">2. åˆ›å»ºä¸€ä¸ªinterfaceä½œä¸ºWeb Serviceçš„è¯·æ±‚é›†åˆï¼Œåœ¨ä¸Šé¢ç”¨æ³¨è§£å†™å…¥éœ€è¦é…ç½®çš„è¯·æ±‚æ–¹æ³•</h6>
<pre><code class="language-kotlin">interface GithubService {
	@GET(&quot;/users/{user}/repos&quot;)
	fun listRepos(@Path(&quot;user&quot;) user: String): Call&lt;List&lt;Repo&gt;&gt;
}
</code></pre>
<h6 id="3-è·å–retrofitå®ä¾‹å•ä¾‹å¯¹è±¡">3. è·å–Retrofitå®ä¾‹(å•ä¾‹å¯¹è±¡)</h6>
<pre><code class="language-kotlin">object Net {
	private val instance = Retrofit.Builder()
    	.addConverterFactory(GsonConverterFactory.create())
    	.baseUrl(&quot;https://api.github.com/&quot;)
    	.build()
    
    //æ³›å‹å®ä¾‹åŒ–
    inline fun &lt;reified T&gt; create():T = instance.create(T::class.java)
}
</code></pre>
<h6 id="4-åˆ›å»ºå‡ºservice-interfaceå®ä¾‹è°ƒç”¨å¯¹åº”çš„æ¥å£æ–¹æ³•åˆ›å»ºå‡ºç›¸åº”çš„å¯ä»¥ç”¨æ¥å‘èµ·ç½‘ç»œè¯·æ±‚çš„callå¯¹è±¡">4. åˆ›å»ºå‡ºService interfaceå®ä¾‹ï¼Œè°ƒç”¨å¯¹åº”çš„æ¥å£æ–¹æ³•ï¼Œåˆ›å»ºå‡ºç›¸åº”çš„å¯ä»¥ç”¨æ¥å‘èµ·ç½‘ç»œè¯·æ±‚çš„Callå¯¹è±¡</h6>
<pre><code class="language-kotlin">val githubService = Net.create&lt;GithubService&gt;()
val listRepos = githubService.listRepos(&quot;hsicen&quot;)
</code></pre>
<h6 id="5-ä½¿ç”¨callexecuteæˆ–è€…callenqueueå‘èµ·è¯·æ±‚">5. ä½¿ç”¨Call.execute()æˆ–è€…Call.enqueue()å‘èµ·è¯·æ±‚</h6>
<pre><code class="language-kotlin">listRepos.enqueue(object : Callback&lt;List&lt;Repo&gt;&gt; {
	override fun onFailure(call: Call&lt;List&lt;Repo&gt;&gt;, t: Throwable) {
		tv_content.text = t.message
	}
	override fun onResponse(call: Call&lt;List&lt;Repo&gt;&gt;, response: Response&lt;List&lt;Repo&gt;&gt;) {
		tv_content.text = response.body().toString()
	}
})
</code></pre>
<h5 id="retrofitæºç åˆ†æ">Retrofitæºç åˆ†æ</h5>
<p>é¦–å…ˆæˆ‘ä»¬ä»ç¦»æˆ‘ä»¬æœ€è¿‘çš„ä½ç½®ä½œä¸ºåˆ‡å…¥ç‚¹(é€šå¸¸æ˜¯ä¸šåŠ¡ä»£ç çš„æœ€åä¸€è¡Œ)ï¼Œè¿™é‡Œæˆ‘ä»¬ç‚¹è¿›Call.enqueue()ï¼Œçœ‹çœ‹é‡Œé¢çš„ä»£ç é€»è¾‘</p>
<pre><code class="language-java">void enqueue(Callback&lt;T&gt; callback);
</code></pre>
<p>å‘ç°è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ²¡æœ‰å…·ä½“å®ç°ï¼Œåˆ‡å…¥å¤±è´¥ï¼›ç°åœ¨éœ€è¦é€æ­¥å›é€€å¯»æ‰¾åˆ°ä¸‹ä¸€ä¸ªåˆ‡å…¥ç‚¹<code>Retrofit.create()</code></p>
<pre><code class="language-java">public &lt;T&gt; T create(final Class&lt;T&gt; service) {
	Utils.validateServiceInterface(service);  //æ¥å£éªŒè¯
	if (validateEagerly) {eagerlyValidateMethods(service);}  //æå‰éªŒè¯æ‰€æœ‰æ–¹æ³•çš„æ­£ç¡®æ€§ï¼Œä¼šç”¨åˆ°åå°„
	//åŠ¨æ€ä»£ç†  åˆ›å»ºä¸€ä¸ªè¿è¡Œæ—¶çš„ç±»ï¼ŒInterfaceçš„æ¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨éƒ½ä¼šäº¤ç”±InvocationHandleræ¥å¤„ç†
	return (T) Proxy.newProxyInstance(service.getClassLoader(), new Class&lt;?&gt;[] { service },new InvocationHandler() {
		private final Platform platform = Platform.get();
		private final Object[] emptyArgs = new Object[0];

		@Override public @Nullable Object invoke(Object proxy, Method method,@Nullable Object[] args) throws Throwable {
			// If the method is a method from Object then defer to normal invocation.
			if (method.getDeclaringClass() == Object.class) {//ç»§æ‰¿è‡ªObjectçš„æ–¹æ³•
				return method.invoke(this, args);
			}
			if (platform.isDefaultMethod(method)) {  //æ¥å£é»˜è®¤æ–¹æ³• Java8
				return platform.invokeDefaultMethod(method, service, proxy, args);
			}

 			//å…³é”®ä»£ç 
			return loadServiceMethod(method).invoke(args != null ? args : emptyArgs);
		}
	});
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°å‰é¢ä¸¤è¡Œæ˜¯ä»£ç å¥å£®æ€§éªŒè¯ï¼Œ<strong>æ ¸å¿ƒä»£ç </strong>æ˜¯<code>Proxy.newProxyInstance()</code>æ–¹æ³•æ¥åˆ›å»ºServiceå®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•ä¼šä¸ºå‚æ•°ä¸­çš„Interfaceåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å®ç°äº†Interfaceçš„æ¯ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”æ¯ä¸ªæ–¹æ³•çš„å®ç°éƒ½ä¼šé›·åŒçš„ï¼šè°ƒç”¨å¯¹è±¡å®ä¾‹å†…éƒ¨çš„ä¸€ä¸ª<code>InvocationHandler</code>æˆå‘˜å˜é‡çš„invokeæ–¹æ³•ï¼Œå¹¶æŠŠè‡ªå·±çš„æ–¹æ³•ä¿¡æ¯ä¼ é€’è¿›å»ã€‚è¿™æ ·å°±åœ¨å®è´¨ä¸Šå®ç°äº†ä»£ç†é€»è¾‘ï¼›Interfaceä¸­çš„æ–¹æ³•å…¨éƒ¨ç”±ä¸€ä¸ªå¦å¤–è®¾å®šçš„InvocationHandlerå¯¹è±¡æ¥è¿›è¡Œä»£ç†æ“ä½œã€‚å¹¶ä¸”è¿™äº›æ–¹æ³•çš„å…·ä½“å®ç°æ˜¯åœ¨è¿è¡Œæ—¶ç”ŸæˆInterfaceå®ä¾‹æ—¶æ‰ç¡®å®šçš„ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ã€‚è¿™å°±æ˜¯åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå¤§è‡´åƒä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="language-kotlin">//GithubService.kt
interface GithubService {
	@GET(&quot;/users/{user}/repos&quot;)
	fun listRepos(@Path(&quot;user&quot;) user: String): Call&lt;List&lt;Repo&gt;&gt;

	@GET(&quot;/users/hsicen&quot;)
	fun getUser(): Call&lt;User&gt;
}

//realService
class RealService : GithubService {
	private val invocationHandler = object : InvocationHandler {
		private val platform = Platform.get();

		override fun invoke(proxy: Any?, method: Method?, args: Array&lt;out Any&gt;?): Any {
			//æ‰®æ¼”ä»£ç†è§’è‰²ï¼Œå¯¹ä¸åŒçš„æ–¹æ³•åšä¸åŒçš„å¤„ç†
			return Any()
		}
	}

	override fun listRepos(user: String): Call&lt;List&lt;Repo&gt;&gt; {
		val method = GithubService::class.java.getMethod(&quot;listRepos&quot;)
		return invocationHandler.invoke(this, method, null) as Call&lt;List&lt;Repo&gt;&gt;
	}

	override fun getUser(): Call&lt;User&gt; {
		val method = GithubService::class.java.getMethod(&quot;getUser&quot;)
		return invocationHandler.invoke(this, method, null) as Call&lt;User&gt;
	}
}
</code></pre>
<p>æ¥ä¸‹ä¸»è¦å…³æ³¨<code>loadServiceMethod(method).invoke(args != null ? args : emptyArgs)</code>è¿™å¥ä»£ç ï¼Œ<code>loadServiceMethod()</code>å’Œ<code>invoke()</code>æ˜¯è¿™ä¸ªæ–¹æ³•ä¸­å…³é”®ä½œç”¨çš„ä»£ç ï¼›<code>invoke()</code>å°±æ˜¯Retrofitåˆ›å»ºServiceå®ä¾‹çš„å…³é”®</p>
<pre><code class="language-java">abstract @Nullable T invoke(Object[] args);
</code></pre>
<p>ç‚¹è¿›å»å‘ç°ï¼Œè¿™æ˜¯ServiceMethodçš„æŠ½è±¡æ–¹æ³•ï¼›é‚£ä¹ˆåªå¥½çœ‹çœ‹loadServiceMethodæ–¹æ³•çš„å…·ä½“é€»è¾‘</p>
<pre><code class="language-java">ServiceMethod&lt;?&gt; loadServiceMethod(Method method) {
	ServiceMethod&lt;?&gt; result = serviceMethodCache.get(method);
	if (result != null) return result;
	synchronized (serviceMethodCache) {
		result = serviceMethodCache.get(method);
			if (result == null) {
				result = ServiceMethod.parseAnnotations(this, method);
				serviceMethodCache.put(method, result);
			}
	}
	return result;
}
</code></pre>
<p>ç„¶åå†ç‚¹è¿›<code>ServiceMethod.parseAnnotations()</code>æ–¹æ³•</p>
<pre><code class="language-java">static &lt;T&gt; ServiceMethod&lt;T&gt; parseAnnotations(Retrofit retrofit, Method method) {
	RequestFactory requestFactory = RequestFactory.parseAnnotations(retrofit, method);

	Type returnType = method.getGenericReturnType();
	if (Utils.hasUnresolvableType(returnType)) {
		throw methodError(method,&quot;Method return type must not include a type variable or wildcard: %s&quot;, returnType);
	}
	if (returnType == void.class) {
		throw methodError(method, &quot;Service methods cannot return void.&quot;);
	}

	return HttpServiceMethod.parseAnnotations(retrofit, method, requestFactory);
}
</code></pre>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¸»è¦çœ‹<code>HttpServiceMethod.parseAnnotations()</code>ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä»£ç å°±æ¯”è¾ƒå¤šäº†ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹è¿”å›å¤„çš„ä»£ç </p>
<pre><code class="language-java">if (!isKotlinSuspendFunction) {
	return new CallAdapted&lt;&gt;(requestFactory, callFactory, responseConverter, callAdapter);
} else if (continuationWantsResponse) {
	//noinspection unchecked Kotlin compiler guarantees ReturnT to be Object.
	return (HttpServiceMethod&lt;ResponseT, ReturnT&gt;) new SuspendForResponse&lt;&gt;(requestFactory,callFactory, responseConverter, (CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt;) callAdapter);
} else {
	//noinspection unchecked Kotlin compiler guarantees ReturnT to be Object.
	return (HttpServiceMethod&lt;ResponseT, ReturnT&gt;) new SuspendForBody&lt;&gt;(requestFactory,callFactory, responseConverter, (CallAdapter&lt;ResponseT, Call&lt;ResponseT&gt;&gt;) callAdapter,continuationBodyNullable);
}
</code></pre>
<p><code>HttpServiceMethod</code>æ˜¯ <code>ServiceMethod</code>çš„å­ç±»ï¼Œè€Œ<code>HttpServiceMethod.parseAnnotations()</code>æ˜¯è¿”å›ServiceMethodå¯¹è±¡ï¼Œç„¶åå†æ‰§è¡ŒServiceMethodçš„invokeæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥çœ‹HttpServiceMethodçš„invokeæ–¹æ³•</p>
<pre><code class="language-java">@Override final @Nullable ReturnT invoke(Object[] args) {
	Call&lt;ResponseT&gt; call = new OkHttpCall&lt;&gt;(requestFactory, args, callFactory, responseConverter);
	return adapt(call, args);
}
</code></pre>
<p>åœ¨invoke()ä¸­åˆ›å»ºäº†ä¸€ä¸ªOkHttpCallï¼Œç„¶åè°ƒç”¨äº†adapt()æ–¹æ³•ï¼Œè¿”å›æˆ‘ä»¬éœ€è¦çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹è¿™ä¸ªadapt()æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Œç»§ç»­ç‚¹è¿›å»</p>
<pre><code class="language-java">protected abstract @Nullable ReturnT adapt(Call&lt;ResponseT&gt; call, Object[] args);
</code></pre>
<p>åˆæ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œçœ‹æ¥ç›´æ¥æŸ¥çœ‹adapt()æ–¹æ³•è¡Œä¸é€šï¼Œé‚£ä¹ˆå°±åªå¥½çœ‹çœ‹OkHttpCallåšäº†ä»€ä¹ˆäº†ï¼Œæˆ‘ä»¬ç‚¹è¿›OkHttpCallçœ‹ä¸€ä¸‹å§</p>
<pre><code class="language-java">final class OkHttpCall&lt;T&gt; implements Call&lt;T&gt; {
   .......
}
</code></pre>
<p>OkHttpCallæ˜¯ç»§æ‰¿è‡ªRetrofitçš„Callçš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥æ²¡èµ°é€šçš„é‚£ä¸ªCall(å› ä¸ºCallçš„enqueueæ–¹æ³•æ˜¯æŠ½è±¡çš„)ï¼Œé‚£ä¹ˆå®ƒæœ‰æ²¡æœ‰å®ç°Callçš„enqueue()æ–¹æ³•å‘¢ï¼Ÿ</p>
<pre><code class="language-java">@Override public void enqueue(final Callback&lt;T&gt; callback) {
	okhttp3.Call call;
	synchronized (this) {
		call = rawCall;
		if (call == null &amp;&amp; failure == null) {
			call = rawCall = createRawCall();
		}
	}

	call.enqueue(new okhttp3.Callback() {
		@Override public void onResponse(okhttp3.Call call, okhttp3.Response rawResponse) {
			Response&lt;T&gt; response = parseResponse(rawResponse);
			callback.onResponse(OkHttpCall.this, response);
		}

		@Override public void onFailure(okhttp3.Call call, IOException e) {
			callFailure(e);
		}
	});
}
</code></pre>
<p>ç”±äºenqueue()ä¸­ä»£ç é‡è¾ƒå¤§ï¼Œæˆ‘ç²¾ç®€äº†è¿™éƒ¨åˆ†ä»£ç ï¼Œenqueue()ä¸»è¦çš„å·¥ä½œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªokhttp3çš„Callï¼Œç„¶åè°ƒç”¨è¿™ä¸ªcallçš„enqueue()æ–¹æ³•å»å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œç„¶åå°†å›è°ƒç»“æœé¢„å¤„ç†ä¹‹åï¼Œäº¤ç”±Retrofitçš„Callback</p>
<p>å› æ­¤ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å¯¹Retrofitçš„å·¥ä½œæµç¨‹å°±æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„äº†è§£ï¼ŒRetrofité€šè¿‡åŠ¨æ€ä»£ç†åˆ›å»ºå‡ºServiceå®ä¾‹ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå®ä¾‹è°ƒç”¨å¯¹åº”çš„apiå¾—åˆ°ä¸€ä¸ªRetrofitçš„Callå¯¹è±¡ï¼Œè¿™ä¸ªCallå¯¹è±¡åˆåˆ›å»ºäº†ä¸€ä¸ªOkHttp3çš„Callå®ä¾‹å»å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œç„¶åå°†ç»“æœå›è°ƒç»™Retrofitçš„Callback</p>
<p>åœ¨ä¸Šé¢çš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªç‚¹è¿˜æ²¡æœ‰è§£å†³ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºå‡ºOkHttpCallå¯¹è±¡åï¼Œç„¶åè°ƒç”¨äº†adapt()æ–¹æ³•ï¼Œè¿™ä¸ªadapt()æ–¹æ³•æ˜¯å¹²ä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿåšäº†å“ªäº›å¤„ç†ï¼Ÿ</p>
<p>åœ¨å·¥ä½œä¸­æˆ‘ä»¬çŸ¥é“ï¼Œadapteræ˜¯é€‚é…å™¨çš„æ„æ€ï¼Œä½œä¸ºä¸­é—´æ¡¥æ¢çš„ä½œç”¨ï¼›çŒœæµ‹æ˜¯ä¸æ˜¯å¯¹OkHttpCallçš„è½¬æ¢å¤„ç†å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬çŸ¥é“Retrofitå¯ä»¥å’ŒRxJavaç»“åˆä½¿ç”¨ï¼Œæ˜¯ä¸æ˜¯å°±æ˜¯å› ä¸ºè¿™ä¸ªadapt()çš„ä½œç”¨å‘¢ï¼Ÿå½“ç„¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŸ¥çœ‹æºç ï¼Œæ‰èƒ½æ‰¾åˆ°ç­”æ¡ˆ</p>
<p>æ‰¾åˆ°åˆšæ‰é‚£ä¸ªæŠ½è±¡çš„adapt()æ–¹æ³•ï¼ŒæŸ¥çœ‹å…¶å®ç°çš„åœ°æ–¹ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°HttpServiceMethodå†…éƒ¨æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»å®ç°äº†è¯¥æŠ½è±¡æ–¹æ³•</p>
<pre><code class="language-java">static final class CallAdapted&lt;ResponseT, ReturnT&gt; extends HttpServiceMethod&lt;ResponseT, ReturnT&gt; {
	private final CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter;

	CallAdapted(RequestFactory requestFactory, okhttp3.Call.Factory callFactory,Converter&lt;ResponseBody, ResponseT&gt; responseConverter,CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter) {
		super(requestFactory, callFactory, responseConverter);
		this.callAdapter = callAdapter;
	}

	@Override protected ReturnT adapt(Call&lt;ResponseT&gt; call, Object[] args) {
		return callAdapter.adapt(call);
	}
}
</code></pre>
<p>åœ¨è¿™ä¸ªç±»ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªCallAdapterç±»ï¼Œå¹¶å°†adapt()äº¤ç”±CallAdapterçš„adapt()æ¥å®ç°ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°åœ¨Retrofitåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæœ‰è¿™ä¹ˆä¸€å¥ä»£ç  <code>addCallAdapterFactory(RxJava2CallAdapterFactory.create())</code>,åŠ ä¸Šè¿™å¥ä»£ç åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†Callå¯¹è±¡è½¬åŒ–ä¸ºObservableå¯¹è±¡ï¼Œå’ŒRxJavaè¿›è¡Œäº¤äº’äº†ï¼Œçœ‹æ¥è¿™ä¸ªadapt()æ–¹æ³•å¾ˆå¯èƒ½å°±æ˜¯å°†OkHttpCallè¿›è¡Œè½¬æ¢çš„ä½œç”¨ï¼Œä¸ºäº†éªŒè¯æˆ‘ä»¬çš„çŒœæƒ³ï¼Œç»§ç»­æ·±å…¥æºç åˆ†æ</p>
<p>è¿™ä¸ªé™æ€å†…éƒ¨ç±»çš„callAdapteræ˜¯æ„é€ æ–¹æ³•ä¼ è¿›æ¥çš„ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„å‘ä¸Šæ‰¾</p>
<blockquote>
<p>CallAdapted -&gt; callAdapter<br>
HttpServiceMethod -&gt; createCallAdapter()<br>
Retrofit -&gt; callAdapter()<br>
Retrofit -&gt; nextCallAdapter()  callAdapterFactories.get(i)</p>
</blockquote>
<p>æœ€åæˆ‘ä»¬å‘ç°CallAdapteræ¥è‡ªcallAdapterFactorieså˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±éœ€è¦æ‰¾åˆ°callAdapterFactoriesçš„æ¥æº</p>
<pre><code class="language-java">// Make a defensive copy of the adapters and add the default Call adapter.
List&lt;CallAdapter.Factory&gt; callAdapterFactories = new ArrayList&lt;&gt;(this.callAdapterFactories);
callAdapterFactories.addAll(platform.defaultCallAdapterFactories(callbackExecutor));
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸ªcallAdapterFactoriesåˆ†äº†ä¸¤æ¬¡æ·»åŠ ï¼Œä¸€æ¬¡æ˜¯callAdapterFactorieså˜é‡ï¼Œå¦ä¸€æ¬¡æ˜¯å’Œå¹³å°ç›¸å…³çš„é»˜è®¤CallAdapterFactoriesï¼Œæˆ‘ä»¬å…ˆçœ‹è¿™ä¸ªå’Œå¹³å°ç›¸å…³é»˜è®¤çš„CallAdapterFactoriesï¼Œæˆ‘ä»¬è¿™é‡Œå°±åªçœ‹Androidå¹³å°</p>
<pre><code class="language-java">@Override List&lt;? extends CallAdapter.Factory&gt; defaultCallAdapterFactories(@Nullable Executor callbackExecutor) {
	if (callbackExecutor == null) throw new AssertionError();
	DefaultCallAdapterFactory executorFactory = newDefaultCallAdapterFactory(callbackExecutor);
	return Build.VERSION.SDK_INT &gt;= 24
		? asList(CompletableFutureCallAdapterFactory.INSTANCE, executorFactory)
		: singletonList(executorFactory);
}
</code></pre>
<p>é¦–å…ˆå£°æ˜äº†ä¸€ä¸ªExecutorï¼Œçœ‹å‘½åï¼Œè¿™ä¸ªExecutoræ˜¯ç”¨äºå›è°ƒçš„ï¼›ç„¶ååˆ›å»ºäº†DefaultCallAdapterFactory(),æˆ‘ä»¬ç‚¹è¿›è¿™ä¸ªç±»ï¼Œçœ‹å®ƒçš„get()æ–¹æ³•åšäº†ä»€ä¹ˆæ“ä½œ</p>
<pre><code class="language-java">@Override public @Nullable CallAdapter&lt;?, ?&gt; get(Type returnType, Annotation[] annotations, Retrofit retrofit) {
	return new CallAdapter&lt;Object, Call&lt;?&gt;&gt;() {
		@Override public Type responseType() {
			return responseType;
		}

		@Override public Call&lt;Object&gt; adapt(Call&lt;Object&gt; call) {
			return executor == null
				? call
				: new ExecutorCallbackCall&lt;&gt;(executor, call);
		}
	};
}
</code></pre>
<p>æˆ‘åªæˆªå–äº†æ ¸å¿ƒä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨get()æ–¹æ³•ä¸­è¿”å›äº†ä¸€ä¸ªCallAdapterï¼Œè¿˜æœ‰ä¸€ç‚¹åº”è¯¥æ³¨æ„ï¼Œæˆ‘ä»¬æ‰¾è¿™ä¸ªCallAdapterçš„åŸå› æ˜¯ä»€ä¹ˆï¼Œæ˜¯ä¸æ˜¯è¦å¼„æ¸…æ¥šå®ƒçš„adapt()æ–¹æ³•åšäº†ä»€ä¹ˆï¼Œåˆšå¼€å§‹ç”±äºCallAdapterçš„adapt()æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°äº†ç°åœ¨è¿™é‡Œï¼›é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°DefaultCallAdapterFactoryç±»çš„get()æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªCallAdapterï¼Œåœ¨å®ƒçš„adapt()æ–¹æ³•é‡Œè¿”å›äº†ExecutorCallbackCallå¯¹è±¡ï¼Œè¿˜è®°å¾—OkHttpCallä¹ˆï¼Ÿå½“æ—¶OkHttpCallæ˜¯é€šè¿‡adapt(call)æ–¹æ³•ä¼ è¿›æ¥çš„ï¼ŒDefaultCallAdapterFactoryç±»é‡ŒåˆåŸå°ä¸åŠ¨çš„ä¼ ç»™äº†ExecutorCallbackCallç±»ï¼Œç°åœ¨ExecutorCallbackCallå¯¹è±¡åšäº†ä»€ä¹ˆå¤„ç†</p>
<pre><code class="language-java">static final class ExecutorCallbackCall&lt;T&gt; implements Call&lt;T&gt; {
	final Executor callbackExecutor;
	final Call&lt;T&gt; delegate;

	ExecutorCallbackCall(Executor callbackExecutor, Call&lt;T&gt; delegate) {
		this.callbackExecutor = callbackExecutor;
		this.delegate = delegate;
	}

	@Override public void enqueue(final Callback&lt;T&gt; callback) {
		delegate.enqueue(new Callback&lt;T&gt;() {
			@Override public void onResponse(Call&lt;T&gt; call, final Response&lt;T&gt; response) {
				callbackExecutor.execute(new Runnable() {
					@Override public void run() {
						if (delegate.isCanceled()) {
							// Emulate OkHttp's behavior of throwing/delivering an IOException on cancellation.
							callback.onFailure(ExecutorCallbackCall.this, new IOException(&quot;Canceled&quot;));
						} else {
							callback.onResponse(ExecutorCallbackCall.this, response);
						}
					}
				});
			}

			@Override public void onFailure(Call&lt;T&gt; call, final Throwable t) {
				callbackExecutor.execute(new Runnable() {
					@Override public void run() {
						callback.onFailure(ExecutorCallbackCall.this, t);
					}
				});
			}
		});
	}
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒExecutorCallbackCallæ˜¯DefaultCallAdapterFactoryçš„é™æ€å†…éƒ¨ç±»ï¼Œç»§æ‰¿è‡ªRetrofitçš„Callï¼Œä¸OkHttpCallæ˜¯åŒç±»çš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠæ“ä½œåˆ‡å›ä¸»çº¿ç¨‹åå†äº¤ç»™Callback</p>
<p>åˆ†æå®Œè¿™ä¸ªå’Œå¹³å°ç›¸å…³çš„é»˜è®¤CallAdapterï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹callAdapterFactorieså˜é‡ä¸­çš„CallAdapterï¼Œæˆ‘ä»¬ç‚¹å‡»callAdapterFactorieså˜é‡ï¼Œçœ‹çœ‹å“ªé‡Œå¯¹å®ƒè¿›è¡Œäº†æ·»åŠ æ“ä½œ</p>
<pre><code class="language-java">public Builder addCallAdapterFactory(CallAdapter.Factory factory) {
	callAdapterFactories.add(checkNotNull(factory, &quot;factory == null&quot;));
	return this;
}

fun instance(): Retrofit =
	Retrofit.Builder()
	 .addConverterFactory(GsonConverterFactory.create())
	 .addCallAdapterFactory(RxJava2CallAdapterFactory.create())
	 .baseUrl(&quot;https://api.github.com/&quot;)
	 .build()
</code></pre>
<p>è¿™äº›å°±æ˜ç™½äº†ï¼Œè¿™ä¸ªCallAdapteræ˜¯æˆ‘ä»¬åˆå§‹åŒ–Retrofitæ—¶æˆ‘ä»¬ä¸»åŠ¨æ·»åŠ è¿›å»çš„ï¼Œæˆ‘ä»¬è¿™é‡Œæ·»åŠ çš„CallAdapterFactoryæ˜¯å’ŒRxJavaç»“åˆä½¿ç”¨çš„ï¼Œåƒä¸‹é¢è¿™æ ·</p>
<pre><code class="language-kotlin">//GithubService.kt
@GET(&quot;/users/{user}/repos&quot;)
fun listRepos(@Path(&quot;user&quot;) user: String): Observable&lt;List&lt;Repo&gt;&gt;

//å‘èµ·ç½‘ç»œè¯·æ±‚
val repoService = Net.instance().create(GithubService::class.java)
repoService.listRepos(&quot;hsicen&quot;)
 .observeOn(Schedulers.newThread())
 .subscribe(object : Observer&lt;List&lt;Repo&gt;&gt; {
	override fun onComplete() {

	}

	override fun onSubscribe(d: Disposable?) {

	}

	override fun onNext(value: List&lt;Repo&gt;?) {

	}

	override fun onError(e: Throwable?) {

	}
 })
</code></pre>
<p>ä½†æ˜¯Observableå›è°ƒçš„æ¥å£å¤ªå¤šäº†ï¼Œåœ¨Appä¸­æ›´æ¨èä½¿ç”¨Single</p>
<pre><code class="language-kotlin">//GithubService.kt
@GET(&quot;/users/{user}/repos&quot;)
fun listRepos(@Path(&quot;user&quot;) user: String): Observable&lt;List&lt;Repo&gt;&gt;

//å‘èµ·ç½‘ç»œè¯·æ±‚
val repoService = Net.instance().create(GithubService::class.java)
repoService.listRepos(&quot;hsicen&quot;)
	.observeOn(Schedulers.newThread())
	.subscribe(object : SingleObserver&lt;List&lt;Repo&gt;&gt; {
		override fun onSubscribe(d: Disposable?) {

		}

		override fun onSuccess(value: List&lt;Repo&gt;?) {

		}

		override fun onError(e: Throwable?) {

		}
	})
</code></pre>
<p><strong>æºç åˆ†ææ€»ç»“</strong></p>
<ul>
<li>
<p>é€šè¿‡ Retrofit.create(Class)  â½…æ³•åˆ›å»ºå‡º Service interface çš„å®ï¦µï¼Œä»â½½ä½¿å¾— Service ä¸­é…ç½®çš„æ–¹æ³•å˜å¾—å¯ç”¨ï¼Œè¿™æ˜¯ Retrofit ä»£ç ç»“æ„çš„æ ¸å¿ƒ</p>
</li>
<li>
<p>Retrofit.create() â½…æ³•å†…éƒ¨ï¼Œä½¿â½¤çš„æ˜¯Proxy.newProxyInstance() â½…æ³•æ¥åˆ›å»ºServiceå®ï¦µã€‚è¿™ä¸ªæ–¹æ³•ä¼šä¸ºå‚æ•°ä¸­çš„å¤š interfaceï¼ˆå…·ä½“åˆ°Retrofitæ¥è¯´ï¼Œæ˜¯å›ºå®šä¼ å…¥â¼€ä¸ªinterfaceï¼‰åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å®ç°ï¦ºæ‰€æœ‰interfaceçš„æ¯ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”æ¯ä¸ªæ–¹æ³•çš„å®ç°éƒ½æ˜¯ï¥‰åŒçš„ï¼šè°ƒâ½¤å¯¹è±¡å®ï¦µå†…éƒ¨çš„ä¸€ä¸ªInvocationHandler  æˆå‘˜å˜ï¥¾çš„ invoke() â½…æ³•ï¼Œå¹¶æŠŠâ¾ƒâ¼°çš„â½…æ³•ä¿¡æ¯ä¼ é€’è¿›å»ã€‚è¿™æ ·å°±åœ¨å®è´¨ä¸Šå®ç°ï¦ºä»£ï§¤é€»è¾‘ï¼šinterface ä¸­çš„â½…æ³•å…¨éƒ¨ç”±â¼€ä¸ªå¦å¤–è®¾å®šçš„InvocationHandlerå¯¹è±¡æ¥è¿›â¾ä»£ç†æ“ä½œã€‚å¹¶ä¸”ï¼Œè¿™äº›â½…æ³•çš„å…·ä½“å®ç°æ˜¯åœ¨è¿ï¨ˆæ—¶â½£ interfaceå®ï¦µæ—¶æ‰ç¡®å®šçš„ï¼Œâ½½ä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼ˆè™½ç„¶åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å¯ä»¥é€šè¿‡ä»£ç é€»è¾‘æ¨æ–­å‡ºæ¥ï¼‰ã€‚è¿™å°±æ˜¯ã€ŒåŠ¨æ€ä»£ç†ï§¤æœºåˆ¶ã€çš„å…·ä½“å«ä¹‰ã€‚</p>
</li>
<li>
<p>å› æ­¤ï¼Œinvoke() â½…æ³•ä¸­çš„é€»è¾‘ï¼Œå°±æ˜¯ Retrofit åˆ›å»º Service å®ä¾‹çš„å…³é”®ã€‚è¿™ä¸ªâ½…æ³•å†…æœ‰ä¸‰ï¨ˆå…³é”®ä»£ç ï¼Œå…±åŒç»„æˆäº†å…·ä½“é€»è¾‘ï¼š</p>
<ol>
<li>
<p>ServiceMethod çš„åˆ›å»º <code>loadServiceMethod(method)</code><br>
è¿™â¾ä»£ç è´Ÿè´£è¯»å– interface ä¸­åŸæ–¹æ³•çš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬è¿”å›å€¼ç±»å‹ã€â½…æ³•æ³¨è§£ã€å‚æ•°ç±»å‹ã€å‚æ•°æ³¨è§£ï¼‰ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯åšåˆæ­¥åˆ†æã€‚å®é™…è¿”å›çš„æ˜¯ä¸€ä¸ª HttpServiceMethod</p>
</li>
<li>
<p>OkHttpCall  çš„åˆ›å»º  <code>new OkHttpCall&lt;&gt;(requestFactory, args, callFactory, responseConverter)</code><br>
OkHttpCallæ˜¯retrofit2.Call çš„å­ç±»ã€‚è¿™ï¨ˆä»£ç è´Ÿè´£å°†ServiceMethodè§£è¯»åˆ°çš„ä¿¡æ¯ï¼ˆä¸»è¦æ˜¯ä¸€ä¸ª RequestFactory ã€ä¸€ä¸ª OkHttpClient  å’Œâ¼€ä¸ª ResponseConverter ï¼‰å°è£…è¿› OkHttpCall ï¼›è€Œè¿™ä¸ªå¯¹è±¡å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™ï¼ˆä¾‹å¦‚å®ƒçš„ enqueue()  â½…æ³•è¢«è°ƒâ½¤çš„æ—¶å€™ï¼‰ï¼Œåˆ©ç”¨RequestFactoryå’ŒOkHttpClientæ¥åˆ›å»ºä¸€ä¸ªokhttp3.Callå¯¹è±¡ï¼Œå¹¶è°ƒâ½¤è¿™ä¸ªokhttp3.Callå¯¹è±¡æ¥è¿›è¡Œâ½¹ç»œè¯·æ±‚çš„å‘èµ·ï¼Œç„¶ååˆ©ç”¨ResponseConverterå¯¹ç»“æœè¿›ï¨ˆé¢„å¤„ï§¤ä¹‹åï¼Œäº¤å›ç»™ Retrofit çš„ Callback</p>
</li>
<li>
<p>adapt()â½…æ³•  <code>return callAdapter.adapt(new OkHttpCall...)</code><br>
è¿™ä¸ªæ–¹æ³•ä¼šä½¿ç”¨ä¸€ä¸ªCallAdapterå¯¹è±¡æ¥æŠŠOkHttpCallå¯¹è±¡è¿›è¡Œè½¬æ¢ï¼Œâ½£æˆâ¼€ä¸ªæ–°çš„å¯¹è±¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿”å›çš„æ˜¯â¼€ä¸ªExecutorCallbackCallï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠæ“ä½œåˆ‡å›ä¸»çº¿ç¨‹åå†äº¤ç»™Callback ã€‚å¦å¤–ï¼Œå¦‚æœæœ‰è‡ªå®šä¹‰çš„CallAdapterï¼Œè¿™ï§©ä¹Ÿå¯ä»¥â½£æˆåˆ«çš„ç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚ RxJava çš„Observable ï¼Œæ¥è®© Retrofit å¯ä»¥å’Œ RxJava ç»“åˆä½¿ç”¨ã€‚</p>
</li>
</ol>
</li>
</ul>
<h5 id="retrofitä½¿ç”¨æ€»ç»“">Retrofitä½¿ç”¨æ€»ç»“</h5>
<h5 id="1-å¦‚æœè¦ç›´æ¥è·å–ç½‘ç»œè¿”å›çš„å­—ç¬¦ä¸²ä½¿ç”¨responsebodyä½œä¸ºå‚æ•°">1. å¦‚æœè¦ç›´æ¥è·å–ç½‘ç»œè¿”å›çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ResponseBodyä½œä¸ºå‚æ•°</h5>
<pre><code class="language-java">@GET(&quot;sore&quot;)
Call&lt;ResponseBody&gt;  getLol();
</code></pre>
<h5 id="2-ä¸€ä¸ªcallåªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡å¦‚æœè¦å¤šæ¬¡æ‰§è¡Œcallå¯¹è±¡å¯ä»¥é€šè¿‡cloneæ¥cloneä¸€ä»½callä»æ–°è°ƒç”¨">2. ä¸€ä¸ªCallåªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœè¦å¤šæ¬¡æ‰§è¡ŒCallå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡cloneï¼Œæ¥cloneä¸€ä»½callï¼Œä»æ–°è°ƒç”¨</h5>
<pre><code class="language-java">Call newCall = mCall.clone()
</code></pre>
<h5 id="3-å›ºå®šå‚æ•°æŸ¥è¯¢ä¸éœ€è¦åŠ¨æ€æ·»åŠ å‚æ•°ç›´æ¥è°ƒç”¨æŸ¥è¯¢">3. å›ºå®šå‚æ•°æŸ¥è¯¢ï¼Œä¸éœ€è¦åŠ¨æ€æ·»åŠ å‚æ•°ï¼Œç›´æ¥è°ƒç”¨æŸ¥è¯¢</h5>
<pre><code class="language-java">@GET(&quot;/some/endpoint?fixed=query&quot;)
Call&lt;User&gt; someEndpoint();
apiService.someEndpoint();

GET  /some/endpoint?fixed=query  HTTP/1.1
</code></pre>
<h5 id="4-åŠ¨æ€å‚æ•°æŸ¥è¯¢æ¯æ¬¡ç½‘ç»œè¯·æ±‚æŸ¥è¯¢æŒ‡å®šå‚æ•°çš„å†…å®¹">4. åŠ¨æ€å‚æ•°æŸ¥è¯¢ï¼Œæ¯æ¬¡ç½‘ç»œè¯·æ±‚æŸ¥è¯¢æŒ‡å®šå‚æ•°çš„å†…å®¹</h5>
<pre><code class="language-java">@GET(&quot;/some/endpoint&quot;)
Call&lt;User&gt; someEndpoint( @Query(&quot;dynamic&quot;) String dynamic);
apiService.someEndpoint(&quot;query&quot;);

GET  /some/endpoint?dynamic=query  HTTP/1.1
</code></pre>
<h5 id="5-åŠ¨æ€mapå‚æ•°æŸ¥è¯¢">5. åŠ¨æ€Mapå‚æ•°æŸ¥è¯¢</h5>
<pre><code class="language-java">@GET(&quot;/some/endpoint&quot;)
Call&lt;User&gt; someEndpoint(@QueryMap Map&lt;String, String&gt; dynamic);
apiService.someEndpoint(Collections.singletonMap(&quot;dynamic&quot;, &quot;query&quot;));

GET  /some/endpoint?dynamic=query  HTTP/1.1
</code></pre>
<h5 id="6-çœç•¥åŠ¨æ€å‚æ•°æŸ¥è¯¢">6. çœç•¥åŠ¨æ€å‚æ•°æŸ¥è¯¢</h5>
<pre><code class="language-java">@GET(&quot;/some/endpoint&quot;)
Call&lt;User&gt; someEndpoint(@Query(&quot;dynamic&quot;) String dynamic);
apiService.someEndpoint(null);

GET  /some/endpoint  HTTP/1.1
</code></pre>
<h5 id="7-å›ºå®šåŠ¨æ€å‚æ•°æŸ¥è¯¢">7. å›ºå®š+åŠ¨æ€å‚æ•°æŸ¥è¯¢</h5>
<pre><code class="language-java">@GET(&quot;/some/endpoint?fixed=query&quot;)
Call&lt;User&gt; someEndpoint(@Query(&quot;dynamic&quot;) String dynamic);
apiService.someEndpoint(&quot;query&quot;);

GET  /some/endpoint?fixed=query&amp;dynamic=query  HTTP/1.1
</code></pre>
<h5 id="8-è·¯å¾„æ›¿æ¢æŸ¥è¯¢">8. è·¯å¾„æ›¿æ¢æŸ¥è¯¢</h5>
<pre><code class="language-java">@GET(&quot;/some/endpoint/{thing}&quot;)
Call&lt;User&gt; someEndpoint( @Path(&quot;thing&quot;) String thing);
apiService.someEndpoint(&quot;bar&quot;);

GET  /some/endpoint/bar  HTTP/1.1
</code></pre>
<h5 id="8-å›ºå®šå¤´æŸ¥è¯¢">8. å›ºå®šå¤´æŸ¥è¯¢</h5>
<pre><code class="language-java">@GET(&quot;/some/endpoint&quot;)
@Headers(&quot;Accept-Encoding: application/json&quot;)
Call&lt;User&gt; someEndpoint();
apiService.someEndpoint();

GET  /some/endpoint  HTTP/1.1
Accept-Encoding: application/json
</code></pre>
<h5 id="9-åŠ¨æ€å¤´æŸ¥è¯¢">9. åŠ¨æ€å¤´æŸ¥è¯¢</h5>
<pre><code class="language-java">@GET(&quot;/some/endpoint&quot;)
Call&lt;User&gt; someEndpoint(@Header(&quot;Location&quot;) String location);
apiService.someEndpoint(&quot;Droidcon NYC 2015&quot;);

GET  /some/endpoint  HTTP/1.1
Location: Droidcon NYC 2015
</code></pre>
<h5 id="10-å›ºå®šåŠ¨æ€å¤´æŸ¥è¯¢">10. å›ºå®š+åŠ¨æ€å¤´æŸ¥è¯¢</h5>
<pre><code class="language-java">@GET(&quot;/some/endpoint&quot;)
@Headers(&quot;Accept-Encoding: application/json&quot;)
Call&lt;User&gt; someEndpoint(@Header(&quot;Location&quot;) String location);
apiService.someEndpoint(&quot;Droidcon NYC 2015&quot;);

GET  /some/endpoint  HTTP/1.1
Accept-Encoding: application/json
Location: Droidcon NYC 2015
</code></pre>
<h5 id="11-postè¯·æ±‚æ— body">11. Postè¯·æ±‚ï¼Œæ— Body</h5>
<pre><code class="language-java">@POST(&quot;/some/endpoint&quot;)
Call&lt;SomeResponse&gt; someEndpoint();
apiService.someEndpoint();

POST  /some/endpoint  HTTP/1.1
Content-Length: 0
</code></pre>
<h5 id="12-postè¯·æ±‚æœ‰body">12. Postè¯·æ±‚æœ‰Body</h5>
<pre><code class="language-java">@POST(&quot;/some/endpoint&quot;)
Call&lt;SomeResponse&gt; someEndpoint(@Body SomeRequest body);
apiService.someEndpoint();

POST  /some/endpoint  HTTP/1.1
Content-Length: 3
Content-Type: text/html

xdadasd
</code></pre>
<h5 id="13-è¡¨å•ç¼–ç å­—æ®µ">13. è¡¨å•ç¼–ç å­—æ®µ</h5>
<pre><code class="language-java">@FormUrlEncoded
@POST(&quot;/some/endpoint&quot;)
Call&lt;User&gt; someEndpoint( @Field(&quot;name1&quot;) String name1, @Field(&quot;name2&quot;) String name2);
apiService.someEndpoint(&quot;value1&quot;, &quot;value2&quot;);

POST /some/endpoint HTTP/1.1
Content-Length: 25
Content-Type: application/x-www-form-urlencoded

name1=value1&amp;name2=value2
</code></pre>
<h5 id="14-è¡¨å•ç¼–ç å­—æ®µmap">14. è¡¨å•ç¼–ç å­—æ®µï¼ˆMapï¼‰</h5>
<pre><code class="language-java">@FormUrlEncoded
@POST(&quot;/some/endpoint&quot;)
Call&lt;User&gt; someEndpoint( @FieldMap Map&lt;String, String&gt; names);
apiService.someEndpoint(ImmutableMap.of(&quot;name1&quot;, &quot;value1&quot;, &quot;name2&quot;, &quot;value2&quot;));

POST /some/endpoint HTTP/1.1
Content-Length: 25
Content-Type: application/x-www-form-urlencoded

name1=value1&amp;name2=value2
</code></pre>
<h5 id="15-åŠ¨æ€urldynamic-url-parameter">15. åŠ¨æ€Url(Dynamic URL parameter)</h5>
<pre><code class="language-java">@GET
Call&lt;List&lt;Activity&gt;&gt; getActivityList(@Url String url,@QueryMap Map&lt;String, String&gt; map);
Call&lt;List&lt;Activity&gt;&gt; call = service.getActivityList(&quot;http://115.159.198.162:3001/api/ActivitySubjects&quot;, map);
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>http://localhost:4000/post/hello-gridea/</id>
        <link href="http://localhost:4000/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>